<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Todo List - Dojo 1.04 Website</title>
    <link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/dojo/1.4.0/dijit/themes/tundra/tundra.css">
    <link rel="stylesheet" href="styles.css">
    <script src="https://ajax.googleapis.com/ajax/libs/dojo/1.4.0/dojo/dojo.xd.js" 
            djConfig="parseOnLoad: true"></script>
    <script>
        dojo.require("dijit.form.Button");
        
        var todos = [];
        
        function goBack() {
            window.location.href = "dashboard.html";
        }
        
        function fetchTodos() {
            var tbody = dojo.byId("todoTableBody");
            tbody.innerHTML = '<tr><td colspan="4" class="loading-message">Loading todos...</td></tr>';
            
            dojo.xhrGet({
                url: "https://dummyjson.com/todos",
                handleAs: "json",
                load: function(response) {
                    todos = response.todos || [];
                    renderTodos();
                },
                error: function(error) {
                    console.error("Error fetching todos:", error);
                    tbody.innerHTML = '<tr><td colspan="4" class="error-message">Failed to load todos. Please try again.</td></tr>';
                }
            });
        }
        
        function renderTodos() {
            var tbody = dojo.byId("todoTableBody");
            
            if (todos.length === 0) {
                tbody.innerHTML = '<tr><td colspan="4" class="empty-message">No todos found.</td></tr>';
                return;
            }
            
            var html = "";
            // Show first 20 todos for better performance
            var displayTodos = todos.slice(0, 20);
            
            for (var i = 0; i < displayTodos.length; i++) {
                var todo = displayTodos[i];
                var statusClass = todo.completed ? "complete" : "pending";
                var statusText = todo.completed ? "Completed" : "Pending";
                
                html += '<tr>';
                html += '<td>' + todo.id + '</td>';
                html += '<td class="todo-title">' + todo.todo + '</td>';
                html += '<td>User ' + todo.userId + '</td>';
                html += '<td><span class="status-badge ' + statusClass + '">' + statusText + '</span></td>';
                html += '</tr>';
            }
            
            tbody.innerHTML = html;
            
            // Update summary
            var completed = todos.filter(function(t) { return t.completed; }).length;
            var pending = todos.length - completed;
            dojo.byId("todoSummary").innerHTML = 
                "Showing " + displayTodos.length + " of " + todos.length + " todos | " +
                completed + " completed, " + pending + " pending";
        }
        
        dojo.addOnLoad(function() {
            console.log("Todo List loaded with Dojo 1.04");
            fetchTodos();
        });
    </script>
</head>
<body class="tundra">
    <div id="container">
        <div class="page-header">
            <h1>Todo List</h1>
            <p class="subtitle">Browse todos from API</p>
        </div>
        
                
        <div class="content-section">
            <button dojoType="dijit.form.Button" 
                    onClick="goBack()" 
                    class="back-button">
                ‚Üê Back to Dashboard
                <script type="dojo/method" event="onClick">
                    goBack();
                </script>
            </button>
            
            <div class="summary-bar" id="todoSummary">
                Loading...
            </div>
            
            <div class="table-container">
                <table class="contents-table">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Todo</th>
                            <th>User</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody id="todoTableBody">
                        <tr>
                            <td colspan="4" class="loading-message">Loading todos...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</body>
</html>
    </div>
</body>
</html>
